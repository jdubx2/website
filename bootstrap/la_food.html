<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Jesse Weiss</title>

    <!-- Bootstrap core CSS -->
    <!-- <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="vendor/bootstrap/css/bootstrap.css" rel="stylesheet">

    <link href="css/3-col-portfolio.css" rel="stylesheet">

    <link href='css/mdb.css' rel='stylesheet'>
    <link href='css/os.css' rel='stylesheet'>

    <link rel="shortcut icon" type="image/png" href="img/favicon.png"/>

  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <div class="container"> <img class ='navlogo' src ='img/logo.png' alt="", height = '55', width = '55'>
        <a class="navbar-brand" href="index.html">jesseweiss.me</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <!-- <li class="nav-item active">
              <a class="nav-link" href="#">Home
                <span class="sr-only">(current)</span>
              </a>
            </li> -->
            <li class="nav-item">
              <a href='index.html'><div class = 'nav-icon'><svg class = 'nav-icon-svg' xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path stroke='none' fill='#f5f5f5' d="M12 9.185l7 6.514v6.301h-14v-6.301l7-6.514zm0-2.732l-9 8.375v9.172h18v-9.172l-9-8.375zm2 14.547h-4v-6h4v6zm10-8.852l-1.361 1.465-10.639-9.883-10.639 9.868-1.361-1.465 12-11.133 12 11.148z"/></svg>
              </div></a>
            </li>
            <li class="nav-item">
              <a href='resume.html'><div class = 'nav-icon'><svg class = 'nav-icon-svg' xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path stroke="none" fill="#f5f5f5" d="M4 22v-20h16v11.543c0 4.107-6 2.457-6 2.457s1.518 6-2.638 6h-7.362zm18-7.614v-14.386h-20v24h10.189c3.163 0 9.811-7.223 9.811-9.614zm-5-1.386h-8v-1h8v1zm0-4h-8v1h8v-1zm0-3h-8v1h8v-1zm-9 0h-1v1h1v-1zm0 3h-1v1h1v-1zm0 3h-1v1h1v-1z"/></svg>
              </div></a>
            </li>
            <li class="nav-item">
              <a href='https://www.linkedin.com/in/jesse-w-weiss/' target="_blank"><div class = 'nav-icon'><svg class = 'nav-icon-svg-li' xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path stroke="none" fill="#f5f5f5" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
              </div></a>
            </li>
            <li class="nav-item">
              <a href='https://github.com/jdubx2' target="_blank"><div class = 'nav-icon'><svg class = 'nav-icon-svg-gh' xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path stroke="none" fill="#f5f5f5" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
              </div></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Page Content -->
    <div class='lax'>
    <div class="container">
      <!-- Page Heading -->
      <div class = 'banner-space'></div>
        <div class = 'text-input-box'>
          <h1 class='article_h1'><b>Quantifying LA Cuisine</b>
            <a style = 'float:right;' href='https://github.com/jdubx2/website/tree/master/la_food' target="_blank"><div class = 'nav-icon'><svg class = 'nav-icon-svg-gh' xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><path stroke="none" fill="black" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
            </div></a>
          <br /><span class = 'sub_span'>Comparing cuisines in Los Angeles by measures of popularity and cleanliness</span></h1>
          <div class='customHr'>a</div>
          <h2><b>Preface</b></h2>
          <p>Recently I came accross a dataset on LA county's <a href = 'https://data.lacity.org/'target="_blank">open data portal</a> containing health inspection results for the majority of restaurants and markets in the
          greater Los Angeles area. As a lover of culinary experiences and food in general, my interest was piqued immediately. What could this dataset tell me about my favorite restaurants and cusines? Only one way to find out!</p>
          <h2><b>initial Exploration</b></h2>
          <p>The health inspection dataset from LA's data portal has just over 390k observations of 18 variables, each row containing the details of a single recorded health violation.
          Here's a sample of the variables that I'll be using in this analysis.</p>
        </div>
        <div class = 'img_box'>
          <table class="gmisc_table" style="border-collapse: collapse; margin-top: 0em; margin-bottom: 0em;">
          <thead>
          <tr>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">ACTIVITY_DATE</th>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">NAME</th>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">SITE_CITY</th>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">SITE_ZIP</th>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">VIOLATION_CODE</th>
          <th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">SCORE</th>
          </tr>
          </thead>
          <tbody>
          <tr>
          <td style="text-align: left;">1</td>
          <td style="text-align: center;">2014-07-29</td>
          <td style="text-align: center;">TIN TIN</td>
          <td style="text-align: center;">ROSEMEAD</td>
          <td style="text-align: center;">91770</td>
          <td style="text-align: center;">16F027</td>
          <td style="text-align: center;">87</td>
          </tr>
          <tr>
          <td style="text-align: left;">2</td>
          <td style="text-align: center;">2014-08-05</td>
          <td style="text-align: center;">LA PAZ BAKERY</td>
          <td style="text-align: center;">CANOGA PARK</td>
          <td style="text-align: center;">91304</td>
          <td style="text-align: center;">16F009</td>
          <td style="text-align: center;">91</td>
          </tr>
          <tr>
          <td style="text-align: left;">3</td>
          <td style="text-align: center;">2014-08-28</td>
          <td style="text-align: center;">LA ZOO</td>
          <td style="text-align: center;">LOS ANGELES</td>
          <td style="text-align: center;">90027</td>
          <td style="text-align: center;">16F009</td>
          <td style="text-align: center;">90</td>
          </tr>
          <tr>
          <td style="text-align: left;">4</td>
          <td style="text-align: center;">2014-08-28</td>
          <td style="text-align: center;">LA ZOO</td>
          <td style="text-align: center;">LOS ANGELES</td>
          <td style="text-align: center;">90027</td>
          <td style="text-align: center;">16F004</td>
          <td style="text-align: center;">90</td>
          </tr>
          <tr>
          <td style="text-align: left;">5</td>
          <td style="text-align: center;">2014-07-01</td>
          <td style="text-align: center;">CRIMINAL COURT BLDG - KITCHEN</td>
          <td style="text-align: center;">LOS ANGELES</td>
          <td style="text-align: center;">90012</td>
          <td style="text-align: center;">16F004</td>
          <td style="text-align: center;">91</td>
          </tr>
          </tbody>
          </table>
        </div>
        <div class = 'text-input-box'>
        <p>Since I'm interested in working with this data at the inspection level (slightly less granular than individual violations), the first step will be to
        aggregate each inspection by business name, location and assessed health score. I'll also add a "violations" variable to count the number of violations
        an establishment has received. Since some locations have been inspected multiple times, I've decided to to keep only the most recent inspeciton in the
        dataset. First, let's examine therelationship between health scores and violation counts.</p>
        </div>

        <div class = 'text-input-box'>
        <h2><b>Gathering More Data</b></h2>
        <p>After aggregating the dataset we are down to about 37k observations with the following six variables: Name,City,Zip,Score,Violations(count).
        I would like to add cuisine type to the dataset so that I can determine if certain cuisines tend to score hgher than others. Since manually
        reviewing 37k different places to add cuisine labels is out of the question, I turned to Yelp's API for help. Yelp's business categorization
        labels are exactly what I'm looking for and even though I may only be able to retrieve a subset of the entire dataset, it's defintely more
        preferable than the alternative! Yelp's API also provides other data that might be interesting (lat/long coordinates, ratings, reviews) so I'll try
        to grab these attributes as well. First I'm going to move my dataset into MySQL to help facilitate chunking up the dataset for API calls and to
        efficiently pipe data between R and Python.</p>
        </div>
        <div class = 'code-chunk'>
<pre style="background:#211e1e;color:#dadada">library(<span style="color:#c1c144">RMySQL</span>)

<span style="color:#c1c144">mydb</span> <span style="color:#47b8d6">=</span> dbConnect(MySQL(), <span style="color:#c1c144">user</span>=<span style="color:#ad9361">'xxxx'</span>,
              <span style="color:#c1c144">password</span>=<span style="color:#ad9361">'xxxx'</span>,
              <span style="color:#c1c144">dbname</span>=<span style="color:#ad9361">'scraping'</span>,
              <span style="color:#c1c144">host</span>=<span style="color:#ad9361">'localhost'</span>)

dbWriteTable(<span style="color:#c1c144">mydb</span>,
             <span style="color:#c1c144">name</span>=<span style="color:#ad9361">'la_health'</span>,
             <span style="color:#c1c144">value</span>=<span style="color:#c1c144">data</span>,
             <span style="color:#c1c144">field.types</span>=list(<span style="color:#c1c144">NAME</span>=<span style="color:#ad9361">"VARCHAR(100)"</span>,
                              <span style="color:#c1c144">SITE_CITY</span>=<span style="color:#ad9361">"VARCHAR(50)"</span>,
                              <span style="color:#c1c144">SITE_ZIP</span>=<span style="color:#ad9361">"VARCHAR(20)"</span>,
                              <span style="color:#c1c144">SCORE</span>=<span style="color:#ad9361">"INT(7)"</span>,
                              <span style="color:#c1c144">VIOLATIONS</span>=<span style="color:#ad9361">"INT(7)"</span>),
             <span style="color:#c1c144">row.names</span>=<span style="color:#de8e30;font-weight:700">FALSE</span>)
</pre>
        </div>
        <div class = 'text-input-box'>
        <p>Now we'll bring the data into our python environment in chunks using MySQL's LIMIT and OFFSET statements. Then apply some
          cleaning functions to the name, city and zip variables so that they can be used to make API calls.</p>
        </div>
        <div class='code-chunk'>
<pre style="background:#211e1e;color:#f8f8f8"><span style="color:#e28964">import</span> sqlalchemy
<span style="color:#e28964">import</span> pandas <span style="color:#e28964">as</span> pd
<span style="color:#e28964">import</span> re

db <span style="color:#e28964">=</span> sqlalchemy.create_engine(<span style="color:#65b042">'mysql+pymysql://xxxx:xxxx@localhost:3306/scraping'</span>)

la_data <span style="color:#e28964">=</span> pd.read_sql(<span style="color:#65b042">"<span style="color:#e28964">SELECT</span> <span style="color:#e28964">*</span> <span style="color:#e28964">FROM</span> la_health <span style="color:#e28964">ORDER BY</span> NAME <span style="color:#e28964">LIMIT</span> <span style="color:#ddf2a4">5000</span>"</span>, db)

<span style="color:#99cf50">def</span> <span style="color:#89bdff">cleantxt</span>(<span style="color:#3e87e3">text</span>):
    text2 <span style="color:#e28964">=</span> re.sub(<span style="color:#65b042">'#[\s|0-9][0-9]*$'</span>,<span style="color:#65b042">''</span>,text)
    text2 <span style="color:#e28964">=</span> re.sub(<span style="color:#65b042">'[^A-Za-z0-9]+'</span>,<span style="color:#65b042">' '</span>,text2)
    text2 <span style="color:#e28964">=</span> re.sub(<span style="color:#65b042">' '</span>,<span style="color:#65b042">'+'</span>,text2)
    <span style="color:#e28964">return</span> text2

<span style="color:#99cf50">def</span> <span style="color:#89bdff">cleanzip</span>(<span style="color:#3e87e3">zipcode</span>):
    ziptext <span style="color:#e28964">=</span> <span style="color:#9b859d">str</span>(zipcode)
    ziptext <span style="color:#e28964">=</span> ziptext[:<span style="color:#3387cc">5</span>]
    <span style="color:#e28964">return</span> ziptext

la_data[<span style="color:#65b042">'NAME_CLN'</span>] <span style="color:#e28964">=</span> la_data[<span style="color:#65b042">'NAME'</span>].map(cleantxt)
la_data[<span style="color:#65b042">'CITY_CLN'</span>] <span style="color:#e28964">=</span> la_data[<span style="color:#65b042">'SITE_CITY'</span>].map(cleantxt)
la_data[<span style="color:#65b042">'ZIP_CLN'</span>] <span style="color:#e28964">=</span> la_data[<span style="color:#65b042">'SITE_ZIP'</span>].map(cleanzip)
</pre>
        </div>
        <div class = 'text-input-box'>
        <p>Yelp uses oauth and returns api calls as json so we'll use the requests_oauthlib and json libraries to help manage this.
          The getYelp function makes a call to the Yelp API with a business name, city and zipcode. Not all of the results will be a match so
          we need to validate them. We check the call result for zipcode and city compatibility and succesful calls will recieve further processing.
          Fuzzy string matching is used to score the similarity of the original name with Yelp's returned name to help weed out false matches at a
          later point. The function returns a dictionary of original and Yelp supplied attributes that we will use to form an updated dataset.</p>
        </div>
        <div class = 'code-chunk'>
<pre style="background:#211e1e;color:#f8f8f8"><span style="color:#e28964">import</span> json
<span style="color:#e28964">from</span> requests_oauthlib <span style="color:#e28964">import</span> OAuth1Session
<span style="color:#e28964">from</span> fuzzywuzzy <span style="color:#e28964">import</span> fuzz

oauth <span style="color:#e28964">=</span> OAuth1Session(client_key,client_secret,resource_owner_key,resource_owner_secret)

<span style="color:#99cf50">def</span> <span style="color:#89bdff">getYelp</span>(<span style="color:#3e87e3">name</span>,<span style="color:#3e87e3">city</span>,<span style="color:#3e87e3">zipcode</span>,<span style="color:#3e87e3">violations</span>,<span style="color:#3e87e3">score</span>):
    <span style="color:#e28964">try</span>:
        r <span style="color:#e28964">=</span> oauth.get(<span style="color:#3e87e3">url</span><span style="color:#e28964">=</span><span style="color:#65b042"><span style="color:#99cf50">r</span>'https://api<span style="color:#ddf2a4">.</span>yelp<span style="color:#ddf2a4">.</span>com/v2/search<span style="color:#e28964">?</span>term='</span>
            <span style="color:#e28964">+</span>name<span style="color:#e28964">+</span><span style="color:#65b042"><span style="color:#99cf50">r</span>'&amp;location='</span><span style="color:#e28964">+</span>city<span style="color:#e28964">+</span><span style="color:#65b042"><span style="color:#99cf50">r</span>'<span style="color:#e28964">+</span>'</span><span style="color:#e28964">+</span>zipcode<span style="color:#e28964">+</span><span style="color:#65b042"><span style="color:#99cf50">r</span>'&amp;limit=1'</span>)
        obj <span style="color:#e28964">=</span> r.json().get(<span style="color:#65b042">'businesses'</span>)[<span style="color:#3387cc">0</span>]
        yelpName <span style="color:#e28964">=</span> obj[<span style="color:#65b042">'name'</span>].upper()
        yelpCity <span style="color:#e28964">=</span> obj[<span style="color:#65b042">'location'</span>][<span style="color:#65b042">'city'</span>].upper()
        yelpZip <span style="color:#e28964">=</span> obj[<span style="color:#65b042">'location'</span>][<span style="color:#65b042">'postal_code'</span>]
        <span style="color:#e28964">if</span> yelpZip <span style="color:#e28964">==</span> zipcode <span style="color:#e28964">and</span> cleantxt(yelpCity) <span style="color:#e28964">==</span> city:
            matchscore <span style="color:#e28964">=</span> fuzz.ratio(cleantxt(yelpName),name)
            catlist <span style="color:#e28964">=</span> []
            <span style="color:#e28964">for</span> x <span style="color:#e28964">in</span> obj[<span style="color:#65b042">'categories'</span>]:
                catlist.append(x[<span style="color:#3387cc">0</span>])
            <span style="color:#e28964">try</span>:
                yelpCat2 <span style="color:#e28964">=</span> catlist[<span style="color:#3387cc">1</span>]
            <span style="color:#e28964">except</span>:
                yelpCat2 <span style="color:#e28964">=</span> <span style="color:#65b042">"NA"</span>
            <span style="color:#e28964">try</span>:
                yelpCat3 <span style="color:#e28964">=</span> catlist[<span style="color:#3387cc">2</span>]
            <span style="color:#e28964">except</span>:
                yelpCat3 <span style="color:#e28964">=</span> <span style="color:#65b042">"NA"</span>
            yelpdict <span style="color:#e28964">=</span> {<span style="color:#65b042">'yelpCat1'</span> : catlist[<span style="color:#3387cc">0</span>],
                        <span style="color:#65b042">'yelpCat2'</span> : yelpCat2,
                        <span style="color:#65b042">'yelpCat3'</span> : yelpCat3,
                        <span style="color:#65b042">'yelpCity'</span> : yelpCity,
                        <span style="color:#65b042">'yelpZip'</span> : yelpZip,
                        <span style="color:#65b042">'yelpName'</span> : yelpName,
                        <span style="color:#65b042">'laName'</span> : name,
                        <span style="color:#65b042">'yelpLatitude'</span> : obj[<span style="color:#65b042">'location'</span>][<span style="color:#65b042">'coordinate'</span>][<span style="color:#65b042">'latitude'</span>],
                        <span style="color:#65b042">'yelpLongitude'</span> : obj[<span style="color:#65b042">'location'</span>][<span style="color:#65b042">'coordinate'</span>][<span style="color:#65b042">'longitude'</span>],
                        <span style="color:#65b042">'yelpRating'</span> : obj[<span style="color:#65b042">'rating'</span>],
                        <span style="color:#65b042">'yelpReviews'</span> : obj[<span style="color:#65b042">'review_count'</span>],
                        <span style="color:#65b042">'laViolations'</span> : violations,
                        <span style="color:#65b042">'laScore'</span> : score,
                        <span style="color:#65b042">'matchScore'</span> : matchscore
                       }
            <span style="color:#e28964">return</span> yelpdict
    <span style="color:#e28964">except</span>:
        <span style="color:#e28964">print</span>(<span style="color:#65b042">"request failed"</span>)
        <span style="color:#e28964">pass</span>
</pre>
        </div>
        <div class = 'text-input-box'>
          <p>To stay within Yelp's rate limits, I ran the getYelp function over a couple of days against 3k-5k
            records at a time and appended the results to a new table in the database.</p>
        </div>
        <div class = 'code-chunk'>
<pre style="background:#211e1e;color:#f8f8f8">yelpList <span style="color:#e28964">=</span> []
<span style="color:#e28964">for</span> row <span style="color:#e28964">in</span> <span style="color:#dad085">range</span>(<span style="color:#dad085">len</span>(la_data)):
    data <span style="color:#e28964">=</span> la_data.loc[row,]
    n <span style="color:#e28964">=</span> data[<span style="color:#65b042">'NAME_CLN'</span>]
    c <span style="color:#e28964">=</span> data[<span style="color:#65b042">'CITY_CLN'</span>]
    z <span style="color:#e28964">=</span> <span style="color:#9b859d">str</span>(data[<span style="color:#65b042">'ZIP_CLN'</span>])
    v <span style="color:#e28964">=</span> data[<span style="color:#65b042">'VIOLATIONS'</span>]
    s <span style="color:#e28964">=</span> data[<span style="color:#65b042">'SCORE'</span>]
    gy <span style="color:#e28964">=</span> getYelp(n,c,z,v,s)
    <span style="color:#e28964">if</span> gy <span style="color:#e28964">is</span> <span style="color:#e28964">not</span> <span style="color:#3387cc">None</span>:
        yelpList.append(gy)

yelpdf <span style="color:#e28964">=</span> pd.DataFrame(yelpList)
yelpdf.to_sql(<span style="color:#65b042">'yelp_data'</span>,db, <span style="color:#3e87e3">if_exists</span><span style="color:#e28964">=</span><span style="color:#65b042">'append'</span>, <span style="color:#3e87e3">flavor</span><span style="color:#e28964">=</span><span style="color:#65b042">'mysql'</span>)
</pre>
        </div>
        <div class = 'text-input-box'>
          <p>Of the 37k+ observations about 55% were matched on Yelp, and I concluded that about 83% of these matches were
            valid by using a cutoff threshhold for the fuzzy match score of the business name. The resulting dataset has
            just under 17k observations. A higher percentage of matches would have been nice but I feel that 17k observations
            is still a sufficient sample of the original population (albeit not exactly random).</p>
          <h2><b>Developing a Metric</b></h2>
          <p>At first I was seeking to compare cuisines by health scores alone but now we have Yelp ratings and review counts to work with as well.
            Since cleanliness and popularity are both valuable traits, creating a metric that encompasses both was a logical next step.
            Through regression and experimentation I created a weighted score bound between 0 and 1 and takes the following inputs:</p>
            <ol style = 'font-size: .95rem;'>
              <li><b>Health Score:</b> Mapped to an exponential function (perfect/near perfect scores are rewarded immensely)</li>
              <li><b>Violation Count:</b> Health score modifier mapped to a linear function. Recieving more violations than typical will lower the overall health score and vice versa</li>
              <li><b>Yelp Rating:</b> Mapped to a linear function using Yelp's 1-5 star rating system</li>
              <li><b>Yelp review Count:</b> Yelp rating modifier mapped to a logrithmic function. Very few reviews will lower the Yelp rating significantly but will have increasingly less affect after a certain threshold</li>
            </ol>
        </div>
        <div class = "img_box">
          <img class = 'img_box_img' src = 'img/food_metric.svg' />
        </div>
        <div class = 'text-input-box'>
          <p>Now I'll create a new variable "weighted score" using the logic above and plot the distribution.</p>
        </div>
        <div class = 'code-chunk'>
<pre style="background:#211e1e;color:#dadada"><span style="color:#c1c144">yelp</span> <span style="color:#47b8d6">&lt;-</span> dbSendQuery(<span style="color:#c1c144">mydb</span>, <span style="color:#ad9361">'SELECT * FROM yelp_data'</span>)
<span style="color:#c1c144">yelp_df</span> <span style="color:#47b8d6">=</span> fetch(<span style="color:#c1c144">yelp</span>, <span style="color:#c1c144">n</span>=<span style="color:#47b8d6">-</span><span style="color:#ccc">1</span>)

lm(<span style="color:#c1c144">data3</span><span style="color:#a1a1ff">$</span><span style="color:#c1c144">VIOLATIONS</span> <span style="color:#a1a1ff">~</span> <span style="color:#c1c144">data3</span><span style="color:#a1a1ff">$</span><span style="color:#c1c144">SCORE</span>)

<span style="color:#c1c144">coeff_score_b</span> <span style="color:#47b8d6">&lt;-</span> <span style="color:#ccc">1.1659144</span>
<span style="color:#c1c144">coeff_score_a</span> <span style="color:#47b8d6">&lt;-</span> <span style="color:#ccc">1</span><span style="color:#47b8d6">/</span>(<span style="color:#c1c144">coeff_score_b</span><span style="color:#47b8d6">^</span><span style="color:#ccc">100</span>)
<span style="color:#c1c144">coeff_vio_yint</span> <span style="color:#47b8d6">&lt;-</span> <span style="color:#ccc">62.201</span>
<span style="color:#c1c144">coeff_vio_score</span> <span style="color:#47b8d6">&lt;-</span> <span style="color:#47b8d6">-</span>.<span style="color:#ccc">6121</span>
<span style="color:#c1c144">coeff_reviews_a</span> <span style="color:#47b8d6">&lt;-</span> .<span style="color:#ccc">1162</span>
<span style="color:#c1c144">coeff_reviews_b</span> <span style="color:#47b8d6">&lt;-</span> <span style="color:#ccc">1.0898</span>

<span style="color:#c1c144">yelp_df</span> <span style="color:#47b8d6">&lt;-</span> <span style="color:#c1c144">yelp_df</span> %<span style="color:#47b8d6">></span>%
  mutate(<span style="color:#c1c144">transfScore</span> <span style="color:#47b8d6">=</span> <span style="color:#c1c144">coeff_score_a</span> <span style="color:#47b8d6">*</span> (<span style="color:#c1c144">coeff_score_b</span> <span style="color:#47b8d6">^</span> <span style="color:#c1c144">laScore</span>),
         <span style="color:#c1c144">transfVio1</span> <span style="color:#47b8d6">=</span> <span style="color:#c1c144">coeff_vio_yint</span> <span style="color:#47b8d6">+</span> (<span style="color:#c1c144">coeff_vio_score</span> <span style="color:#47b8d6">*</span> <span style="color:#c1c144">laScore</span>),
         <span style="color:#c1c144">transfVio2</span> <span style="color:#47b8d6">=</span> (<span style="color:#c1c144">transfVio1</span> <span style="color:#47b8d6">-</span> <span style="color:#c1c144">laViolations</span>) <span style="color:#47b8d6">/</span> <span style="color:#c1c144">transfVio1</span> <span style="color:#47b8d6">/</span> <span style="color:#ccc">10</span>,
         <span style="color:#c1c144">transfRate</span> <span style="color:#47b8d6">=</span> <span style="color:#c1c144">yelpRating</span> <span style="color:#47b8d6">/</span> <span style="color:#ccc">5</span>,
         <span style="color:#c1c144">transfRev</span> <span style="color:#47b8d6">=</span> <span style="color:#c1c144">coeff_reviews_a</span> <span style="color:#47b8d6">*</span> log(<span style="color:#c1c144">coeff_reviews_b</span> <span style="color:#47b8d6">*</span> <span style="color:#c1c144">yelpReviews</span>),
         <span style="color:#c1c144">weightedScore</span> <span style="color:#47b8d6">=</span> ((<span style="color:#c1c144">transfScore</span> <span style="color:#47b8d6">+</span> <span style="color:#c1c144">transfVio2</span>) <span style="color:#47b8d6">+</span>
             (<span style="color:#c1c144">transfRate</span> <span style="color:#47b8d6">*</span> <span style="color:#c1c144">transfRev</span>)) <span style="color:#47b8d6">/</span> <span style="color:#ccc">2</span>) %<span style="color:#47b8d6">></span>%
  select(<span style="color:#c1c144">index</span><span style="color:#a1a1ff">:</span><span style="color:#c1c144">yelpZip</span>,<span style="color:#c1c144">weightedScore</span>)
</pre>
        </div>
        <div class = 'img_box'>
          <img class = 'img_box_img' src="img/food_hist.svg" />
        </div>
        <div class = 'text-input-box'>
          <p>Nice, now we have a normally distributed metric that can be used to determine which Los Angeles cuisines tend to serve up
            the tastiest food in the most sanitary environments.</p>
        </div>

    </div>
    </div>
    <!-- /.container -->

    <!-- Footer -->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">&copy; 2018 jesseweiss.me</p>
      </div>
      <!-- /.container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <script src="vendor/bootstrap/js/newjs.js"></script>

  </body>

</html>
